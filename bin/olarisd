#!/bin/bash

PIDFILE="$SNAP_USER_COMMON/olarisd.pid"

RUNNING=false
if [ -f $PIDFILE ]; then
    PID=$(cat $PIDFILE)
    if [ -d "/proc/${PID}" ]; then
        echo "running"
        RUNNING=true
    fi
fi

if [[ $# -eq 0 ]]; then
    echo "Usage: olarisd [start|stop|restart]"
    exit 0
fi

function start {
    if [ $RUNNING = true ]; then
        echo "olarisd is already running"
        exit 0
    fi
        
    echo "Starting olarisd"
    nohup $SNAP/bin/olaris > /dev/null 2>&1 & echo $! > $PIDFILE
    echo "Started"
}

function stop {
    if [ $RUNNING = false ]; then
        echo "olarisd isn't running"
        exit 0
    fi

    echo "Stopping olarisd"
    kill -9 "${PID}"
    echo "Stopped"
}

case "$1" in
    "start") start ;;
    "stop") stop;;
    "restart")
        stop
        start
        ;;
esac
