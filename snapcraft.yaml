name: olaris
version: 0.2.0-config-dir
summary: An open-source, community driven, media manager and transcoding server.
description: |
  Olaris is an open-source, community driven, media manager and transcoding server.

base: core18
grade: stable
confinement: strict

architectures:
  - build-on: i386
  - build-on: amd64
#  - build-on: arm
#  - build-on: arm64

parts:
  olaris:
    plugin: dump
    # source: https://gitlab.com/olaris/olaris-server/-/jobs/artifacts/$SNAPCRAFT_PROJECT_VERSION/download?job=compile
    source: https://gitlab.com/olaris/olaris-server/-/jobs/238497549/artifacts/download
    source-type: zip
#    organize:
#      'build/olaris-linux-amd64': usr/bin/
#      'build/olaris-linux-386': usr/bin/
#      'build/olaris-linux-arm': usr/bin/
#      'build/olaris-linux-arm64': usr/bin/
    override-build: |
      ARCHITECTURE=$(dpkg --print-architecture)
      
      if [ ${ARCHITECTURE} = "i386" ]; then
        mv build/olaris-linux-386 /usr/bin/olaris
      elif [ ${ARCHITECTURE} = "amd64" ]; then
        mv build/olaris-linux-amd64 /usr/bin/olaris
      fi
      snapcraftctl build

  olarisd:
    plugin: dump
    source: ./bin
    organize:
      'olarisd': usr/bin/
      'olaris': usr/bin/
apps:
  olaris:
    command: usr/bin/olaris
    plugs:
      - home
      - network
      - network-bind

hooks:
  install:
    plugs:
      - home
      - network
      - network-bind

  # olarisd:
  #   command: usr/bin/olarisd start
  #   # stop-command: usr/bin/olarisd stop
  #   # daemon: simple
  #   plugs:
  #     - home
  #     - allow-config-access
  #     - network
  #     - network-bind
